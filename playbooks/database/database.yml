---
- hosts: database
  become: true
  tasks:
          - name: "Copy hosts"
            copy:
                    src: ./hosts.txt
                    dest: /home/vagrant/hosts.txt
                    owner: root
                    group: wheel
                    mode: '0644'

          - name: "Install and setup Gluster"
            script: db.sh
            
          - name: "Copy MongoDB Repo"
            copy:
                    src: repo/mongodb-org-4.4.repo
                    dest: /etc/yum.repos.d
                    owner: root
                    group: wheel
                    mode: '0644'

          - name: "Install MongoDB"
            yum:
                    name: mongodb-org
                    state: present

          - name: MongoDB configuration 
            template:
                   src: templates/mongodb.conf.j2
                   dest: /etc/mongod.conf
                   owner: root
                   group: wheel
                   mode: '0644'

          - name: Create Directory for DB
            file:
                  path: /mnt/glusterfs/db
                  state: directory

          - name: Change dbpath
            shell: "nohup mongod --dbpath /mnt/glusterfs/db &"
          
          - name: "Start MongoDB"
            service:
                    name: mongod
                    state: started
                    enabled: yes




