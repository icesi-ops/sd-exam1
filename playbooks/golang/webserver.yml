---
- hosts: servers
  become: true
  tasks:
          - name: "Install Epel-Release to install Go"
            yum:
                    name: epel-release
                    state: present
                    
          - name: "Install Go"
            yum:
                    name: golang
                    state: present

          - name: "Install MongoDB Driver"
            shell: "go get go.mongodb.org/mongo-driver/mongo"
            
          - name: "Install MongoDB Driver"
            shell: "go get go.mongodb.org/mongo-driver/bson"
            
          - name: "Copy go file"
            copy:
                   src: frontend/main/main.go
                   dest: /home/vagrant/main.go
                   owner: root
                   group: wheel
                   mode: '0644'

          - name: "Install lsof to debug"
            yum:
                    name: lsof
                    state: present

          - name: "Run web service"
            shell: "nohup go run main.go &"
